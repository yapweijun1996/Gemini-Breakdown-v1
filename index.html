<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Gemini Image Analysis - Professional UI</title>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
		
		<style>
			:root {
				--primary-color: #1e40af;
				--primary-hover: #1d4ed8;
				--secondary-color: #64748b;
				--accent-color: #7c3aed;
				--accent-hover: #6d28d9;
				--accent-light: rgba(124, 58, 237, 0.1);
				--success-color: #059669;
				--warning-color: #d97706;
				--error-color: #dc2626;
				--background-primary: #ffffff;
				--background-secondary: #f8fafc;
				--background-tertiary: #f1f5f9;
				--background-accent: #faf5ff;
				--text-primary: #0f172a;
				--text-secondary: #1e293b;
				--text-muted: #475569;
				--text-feature: #334155;
				--border-color: #e2e8f0;
				--border-color-hover: #cbd5e1;
				--border-accent: #c4b5fd;
				--shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
				--shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
				--shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
				--shadow-accent: 0 4px 6px -1px rgba(124, 58, 237, 0.1), 0 2px 4px -2px rgba(124, 58, 237, 0.05);
				--radius-sm: 0.375rem;
				--radius-md: 0.5rem;
				--radius-lg: 0.75rem;
				--radius-xl: 1rem;
			}

			* {
				box-sizing: border-box;
			}

			body {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
				margin: 0;
				padding: 0;
				background: var(--background-secondary);
				color: var(--text-primary);
				line-height: 1.6;
			}

			.app-container {
				min-height: 100vh;
				display: grid;
				grid-template-columns: 420px 1fr;
				grid-template-rows: auto 1fr;
				grid-template-areas: 
					"header header"
					"sidebar main";
			}

			.app-header {
				grid-area: header;
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				color: white;
				padding: 1.5rem 2rem;
				display: flex;
				align-items: center;
				justify-content: space-between;
				box-shadow: var(--shadow-lg);
			}

			.app-title {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				margin: 0;
				font-size: 1.5rem;
				font-weight: 700;
				color: white;
			}

			.app-title i {
				color: rgba(255, 255, 255, 0.9);
				font-size: 1.75rem;
				filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
			}

			.status-indicator {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				font-size: 0.875rem;
				color: rgba(255, 255, 255, 0.9);
				background: rgba(255, 255, 255, 0.1);
				padding: 0.5rem 1rem;
				border-radius: 2rem;
				backdrop-filter: blur(8px);
			}

			.status-dot {
				width: 8px;
				height: 8px;
				border-radius: 50%;
				background: #10b981;
				animation: pulse 2s infinite;
				box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
			}

			@keyframes pulse {
				0%, 100% { opacity: 1; transform: scale(1); }
				50% { opacity: 0.7; transform: scale(1.1); }
			}

			.sidebar {
				grid-area: sidebar;
				background: var(--background-primary);
				border-right: 1px solid var(--border-color);
				padding: 2.5rem 2rem;
				overflow-y: auto;
				display: flex;
				flex-direction: column;
				gap: 2.5rem;
			}

			.main-content {
				grid-area: main;
				padding: 2rem;
				overflow-y: auto;
				display: flex;
				flex-direction: column;
				gap: 1.5rem;
				background: var(--background-secondary);
			}

			.section {
				background: var(--background-primary);
				border-radius: var(--radius-xl);
				padding: 2.5rem;
				box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.03);
				border: 2px solid var(--border-color);
				transition: all 0.3s ease;
				position: relative;
				margin-bottom: 2rem;
			}

			.section:hover {
				box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
				border-color: var(--border-color-hover);
				transform: translateY(-2px);
			}

			.section.accent {
				border-color: var(--border-accent);
				background: linear-gradient(135deg, var(--background-accent) 0%, rgba(124, 58, 237, 0.02) 100%);
			}

			.section-title {
				font-size: 1.3rem;
				font-weight: 800;
				margin: 0 0 2rem 0;
				color: var(--text-primary);
				display: flex;
				align-items: center;
				gap: 1rem;
				position: relative;
				padding: 1rem 1.5rem;
				background: linear-gradient(135deg, var(--accent-light) 0%, rgba(124, 58, 237, 0.05) 100%);
				border-radius: var(--radius-lg);
				border-left: 5px solid var(--accent-color);
				margin: -1rem -1.5rem 2rem -1.5rem;
			}

			.section-title i {
				color: var(--accent-color);
				font-size: 1.6rem;
				background: rgba(124, 58, 237, 0.15);
				padding: 0.75rem;
				border-radius: var(--radius-lg);
				box-shadow: 0 2px 4px rgba(124, 58, 237, 0.1);
			}

			.section-title::after {
				content: '';
				position: absolute;
				bottom: -0.75rem;
				left: 0;
				right: 0;
				height: 2px;
				background: linear-gradient(90deg, var(--accent-color) 0%, transparent 100%);
				border-radius: 1px;
			}

			.dynamic-title {
				transition: all 0.3s ease;
				font-size: 1.5rem;
				font-weight: 800;
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
			}

			.dynamic-title i {
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				background-clip: text;
				font-size: 1.75rem;
			}

			.upload-zone {
				border: 3px solid var(--accent-color);
				border-radius: var(--radius-xl);
				padding: 3rem 2rem;
				text-align: center;
				transition: all 0.3s ease;
				cursor: pointer;
				position: relative;
				background: linear-gradient(135deg, var(--background-primary) 0%, var(--background-accent) 100%);
				box-shadow: var(--shadow-md);
			}

			.upload-zone:hover,
			.upload-zone.drag-over {
				border-color: var(--accent-hover);
				background: var(--accent-light);
				transform: translateY(-2px);
				box-shadow: var(--shadow-lg);
			}

			.upload-zone.has-file {
				border-color: var(--success-color);
				background: rgba(5, 150, 105, 0.05);
				box-shadow: 0 4px 6px -1px rgba(5, 150, 105, 0.1);
			}

			.upload-icon {
				font-size: 3.5rem;
				color: var(--accent-color);
				margin-bottom: 1.5rem;
				transition: all 0.3s ease;
			}

			.upload-zone:hover .upload-icon,
			.upload-zone.drag-over .upload-icon {
				color: var(--accent-hover);
				transform: scale(1.1);
			}

			.upload-text {
				font-size: 1.25rem;
				font-weight: 600;
				color: var(--text-primary);
				margin-bottom: 0.75rem;
			}

			.upload-subtitle {
				font-size: 1rem;
				color: var(--text-secondary);
				font-weight: 500;
			}

			.file-input {
				position: absolute;
				inset: 0;
				opacity: 0;
				cursor: pointer;
			}

			.controls-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1.5rem;
				margin: 2rem 0;
			}

			.control-group {
				display: flex;
				flex-direction: column;
				gap: 0.75rem;
			}

			.control-label {
				font-size: 0.95rem;
				font-weight: 600;
				color: var(--text-primary);
			}

			.control-help {
				font-size: 0.95rem;
				color: var(--text-secondary);
				margin-top: 0.5rem;
				line-height: 1.6;
				font-weight: 500;
				background: var(--background-tertiary);
				padding: 0.75rem 1rem;
				border-radius: var(--radius-md);
				border-left: 3px solid var(--accent-color);
			}

			.select-input {
				padding: 1rem 1.25rem;
				border: 2px solid var(--border-color);
				border-radius: var(--radius-lg);
				font-size: 0.95rem;
				background: var(--background-primary);
				color: var(--text-primary);
				transition: all 0.3s ease;
				font-weight: 500;
				cursor: pointer;
				position: relative;
				appearance: none;
				background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
				background-position: right 0.75rem center;
				background-repeat: no-repeat;
				background-size: 1.5em 1.5em;
				padding-right: 3rem;
			}

			.select-input:hover {
				border-color: var(--accent-color);
				background-color: var(--background-accent);
				transform: translateY(-1px);
				box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.1);
			}

			.select-input:focus {
				outline: none;
				border-color: var(--accent-color);
				box-shadow: 0 0 0 3px var(--accent-light), 0 4px 6px -1px rgba(124, 58, 237, 0.2);
				background-color: var(--background-primary);
				transform: translateY(-1px);
			}

			.select-input:active {
				transform: translateY(0);
			}

			/* Visual feedback for changed selections */
			.select-input.changed {
				border-color: var(--success-color);
				background: linear-gradient(135deg, var(--background-primary) 0%, rgba(5, 150, 105, 0.05) 100%);
				animation: selectionChanged 0.6s ease-out;
			}

			@keyframes selectionChanged {
				0% {
					border-color: var(--success-color);
					box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.3);
				}
				100% {
					border-color: var(--success-color);
					box-shadow: 0 0 0 0px rgba(5, 150, 105, 0);
				}
			}

			.analyze-btn {
				width: 100%;
				padding: 1.25rem 2rem;
				background: linear-gradient(135deg, #1d4ed8 0%, #6d28d9 100%);
				color: white;
				border: none;
				border-radius: var(--radius-lg);
				font-size: 1.1rem;
				font-weight: 700;
				cursor: pointer;
				transition: all 0.3s ease;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 0.75rem;
				margin-top: 1.5rem;
				box-shadow: 0 4px 6px -1px rgba(29, 78, 216, 0.3), 0 2px 4px -2px rgba(29, 78, 216, 0.2);
				border: 2px solid transparent;
			}

			.analyze-btn:hover:not(:disabled) {
				background: linear-gradient(135deg, #1e40af 0%, #5b21b6 100%);
				transform: translateY(-2px);
				box-shadow: 0 10px 15px -3px rgba(29, 78, 216, 0.4), 0 4px 6px -4px rgba(29, 78, 216, 0.3);
			}

			.analyze-btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}

			.spinner {
				width: 18px;
				height: 18px;
				border: 2px solid transparent;
				border-top: 2px solid currentColor;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				to { transform: rotate(360deg); }
			}

			.upload-progress {
				background: var(--background-primary);
				border: 2px solid var(--accent-color);
				border-radius: var(--radius-lg);
				padding: 1.5rem;
				margin-top: 1rem;
				display: none;
			}

			.upload-progress.show {
				display: block;
				animation: slideDown 0.3s ease;
			}

			@keyframes slideDown {
				from { opacity: 0; transform: translateY(-10px); }
				to { opacity: 1; transform: translateY(0); }
			}

			.upload-progress h4 {
				color: var(--accent-color);
				font-size: 1rem;
				font-weight: 600;
				margin: 0 0 1rem 0;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.upload-progress-bar {
				width: 100%;
				height: 6px;
				background: var(--background-tertiary);
				border-radius: 3px;
				overflow: hidden;
				margin-bottom: 0.75rem;
			}

			.upload-progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
				border-radius: 3px;
				transition: width 0.3s ease;
				animation: progressGlow 2s infinite;
			}

			@keyframes progressGlow {
				0%, 100% { box-shadow: 0 0 5px rgba(124, 58, 237, 0.3); }
				50% { box-shadow: 0 0 15px rgba(124, 58, 237, 0.6); }
			}

			.upload-progress-text {
				font-size: 0.9rem;
				color: var(--text-secondary);
				font-weight: 500;
			}

			.analysis-progress {
				background: var(--background-primary);
				border: 2px solid var(--accent-color);
				border-radius: var(--radius-xl);
				padding: 2rem;
				margin: 1.5rem 0;
				text-align: center;
				box-shadow: var(--shadow-accent);
			}

			.analysis-progress h4 {
				color: var(--accent-color);
				font-size: 1.2rem;
				font-weight: 700;
				margin: 0 0 1rem 0;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 0.75rem;
			}

			.analysis-progress .progress-steps {
				display: flex;
				justify-content: space-between;
				margin: 1.5rem 0;
				position: relative;
			}

			.analysis-progress .progress-steps::before {
				content: '';
				position: absolute;
				top: 50%;
				left: 0;
				right: 0;
				height: 2px;
				background: var(--border-color);
				transform: translateY(-50%);
				z-index: 1;
			}

			.analysis-progress .progress-steps .progress-line {
				position: absolute;
				top: 50%;
				left: 0;
				height: 2px;
				background: var(--accent-color);
				transform: translateY(-50%);
				transition: width 0.5s ease;
				z-index: 2;
			}

			.analysis-progress .step {
				position: relative;
				z-index: 3;
				background: var(--background-primary);
				border: 2px solid var(--border-color);
				border-radius: 50%;
				width: 40px;
				height: 40px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 0.875rem;
				font-weight: 600;
				color: var(--text-muted);
				transition: all 0.3s ease;
			}

			.analysis-progress .step.active {
				border-color: var(--accent-color);
				background: var(--accent-color);
				color: white;
				animation: stepPulse 2s infinite;
			}

			.analysis-progress .step.completed {
				border-color: var(--success-color);
				background: var(--success-color);
				color: white;
			}

			@keyframes stepPulse {
				0%, 100% { transform: scale(1); }
				50% { transform: scale(1.1); }
			}

			.analysis-progress .step-labels {
				display: flex;
				justify-content: space-between;
				margin-top: 0.75rem;
			}

			.analysis-progress .step-label {
				font-size: 0.75rem;
				color: var(--text-secondary);
				text-align: center;
				max-width: 80px;
			}

			.analysis-progress .step-label.active {
				color: var(--accent-color);
				font-weight: 600;
			}

			.progress-status-text {
				margin-top: 1.5rem;
				color: var(--accent-color);
				font-weight: 700;
				font-size: 1.1rem;
				text-align: center;
				padding: 0.75rem 1.5rem;
				background: var(--accent-light);
				border: 2px solid var(--border-accent);
				border-radius: var(--radius-lg);
				animation: statusPulse 2s infinite;
			}

			@keyframes statusPulse {
				0%, 100% { 
					background: var(--accent-light);
					border-color: var(--border-accent);
				}
				50% { 
					background: rgba(124, 58, 237, 0.15);
					border-color: var(--accent-color);
				}
			}

			.preview-container {
				margin-top: 1.5rem;
				display: none;
			}

			.preview-container.show {
				display: block;
			}

			.preview-image {
				width: 100%;
				max-height: 220px;
				object-fit: cover;
				border-radius: var(--radius-lg);
				border: 2px solid var(--border-color);
			}

			.image-info {
				margin-top: 1rem;
				padding: 1rem;
				background: var(--background-tertiary);
				border-radius: var(--radius-lg);
				font-size: 0.95rem;
				color: var(--text-secondary);
				border: 1px solid var(--border-color);
			}

			.chat-container {
				flex: 1;
				display: flex;
				flex-direction: column;
				min-height: 0;
			}

			.chat-messages {
				flex: 1;
				overflow-y: auto;
				padding: 1.5rem;
				display: flex;
				flex-direction: column;
				gap: 1.5rem;
				min-height: 600px;
				max-height: 75vh;
			}

			.message {
				padding: 1.5rem 1.75rem;
				border-radius: var(--radius-xl);
				max-width: 85%;
				word-wrap: break-word;
				position: relative;
				animation: slideIn 0.4s ease-out;
				box-shadow: var(--shadow-sm);
			}

			@keyframes slideIn {
				from {
					opacity: 0;
					transform: translateY(15px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.message.user {
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				color: white;
				align-self: flex-end;
				border-bottom-right-radius: var(--radius-sm);
			}

			.message.system {
				background: var(--background-tertiary);
				color: var(--text-secondary);
				align-self: center;
				font-style: italic;
				font-size: 0.95rem;
				max-width: 70%;
				text-align: center;
				border: 1px solid var(--border-color);
			}

			.message.model {
				background: var(--background-primary);
				border: 2px solid var(--border-color);
				color: var(--text-primary);
				align-self: flex-start;
				border-bottom-left-radius: var(--radius-sm);
			}

			.message.model .analysis-content {
				line-height: 1.9;
				font-size: 0.95rem;
			}

			/* Enhanced section headers with icons and better visual hierarchy */
			.message.model .analysis-content h3 {
				color: var(--accent-color);
				font-size: 1.3rem;
				font-weight: 800;
				margin: 2.5rem 0 1.5rem 0;
				padding: 1rem 1.25rem;
				background: linear-gradient(135deg, var(--accent-light) 0%, rgba(124, 58, 237, 0.05) 100%);
				border-radius: var(--radius-lg);
				border-left: 5px solid var(--accent-color);
				display: flex;
				align-items: center;
				gap: 0.75rem;
				box-shadow: var(--shadow-sm);
			}

			.message.model .analysis-content h3:first-child {
				margin-top: 0;
			}

			.message.model .analysis-content h3::before {
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				font-size: 1.1rem;
			}

			.message.model .analysis-content h3[data-section="issues"]::before {
				content: "\f071"; /* warning triangle */
				color: var(--warning-color);
			}

			.message.model .analysis-content h3[data-section="usability"]::before {
				content: "\f4fe"; /* user cog */
				color: var(--error-color);
			}

			.message.model .analysis-content h3[data-section="positive"]::before {
				content: "\f058"; /* check circle */
				color: var(--success-color);
			}

			.message.model .analysis-content h3[data-section="recommendations"]::before {
				content: "\f0eb"; /* lightbulb */
				color: var(--primary-color);
			}

			/* Improved list styling with better spacing */
			.message.model .analysis-content ul {
				margin: 1.5rem 0;
				padding: 0;
				list-style: none;
			}

			.message.model .analysis-content li {
				margin-bottom: 1.25rem;
				line-height: 1.8;
				position: relative;
				padding-left: 0;
			}

			/* Enhanced card-style layout for each item */
			.message.model .analysis-content .analysis-item {
				background: var(--background-primary);
				border: 2px solid var(--border-color);
				border-radius: var(--radius-lg);
				padding: 1.25rem 1.5rem;
				margin: 1rem 0;
				box-shadow: var(--shadow-sm);
				transition: all 0.3s ease;
			}

			.message.model .analysis-content .analysis-item:hover {
				border-color: var(--border-color-hover);
				box-shadow: var(--shadow-md);
				transform: translateY(-1px);
			}

			.message.model .analysis-content .issue-item {
				background: linear-gradient(135deg, rgba(217, 119, 6, 0.05) 0%, rgba(217, 119, 6, 0.02) 100%);
				border: 2px solid rgba(217, 119, 6, 0.2);
				border-left: 5px solid var(--warning-color);
				padding: 1.25rem 1.5rem;
				margin: 1rem 0;
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-sm);
			}

			.message.model .analysis-content .issue-item::before {
				content: "\f071";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--warning-color);
				margin-right: 0.75rem;
				font-size: 1rem;
			}

			.message.model .analysis-content .usability-item {
				background: linear-gradient(135deg, rgba(220, 38, 38, 0.05) 0%, rgba(220, 38, 38, 0.02) 100%);
				border: 2px solid rgba(220, 38, 38, 0.2);
				border-left: 5px solid var(--error-color);
				padding: 1.25rem 1.5rem;
				margin: 1rem 0;
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-sm);
			}

			.message.model .analysis-content .usability-item::before {
				content: "\f4fe";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--error-color);
				margin-right: 0.75rem;
				font-size: 1rem;
			}

			.message.model .analysis-content .positive-item {
				background: linear-gradient(135deg, rgba(5, 150, 105, 0.08) 0%, rgba(5, 150, 105, 0.03) 100%);
				border: 2px solid rgba(5, 150, 105, 0.3);
				border-left: 5px solid var(--success-color);
				padding: 1.25rem 1.5rem;
				margin: 1rem 0;
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-sm);
			}

			.message.model .analysis-content .positive-item::before {
				content: "\f058";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--success-color);
				margin-right: 0.75rem;
				font-size: 1rem;
			}

			.message.model .analysis-content .recommendation-item {
				background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(30, 64, 175, 0.02) 100%);
				border: 2px solid rgba(30, 64, 175, 0.2);
				border-left: 5px solid var(--primary-color);
				padding: 1.25rem 1.5rem;
				margin: 1rem 0;
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-sm);
				position: relative;
			}

			.message.model .analysis-content .recommendation-item::before {
				content: "\f0eb";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--primary-color);
				margin-right: 0.75rem;
				font-size: 1rem;
			}

			/* Action-oriented styling for recommendations */
			.message.model .analysis-content .action-item {
				background: linear-gradient(135deg, var(--accent-light) 0%, rgba(124, 58, 237, 0.05) 100%);
				border: 2px solid var(--border-accent);
				border-left: 5px solid var(--accent-color);
				padding: 1.5rem;
				margin: 1rem 0;
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow-md);
			}

			.message.model .analysis-content .action-item .action-title {
				font-weight: 700;
				color: var(--accent-color);
				font-size: 1.05rem;
				margin-bottom: 0.5rem;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.message.model .analysis-content .action-item .action-title::before {
				content: "\f138";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--accent-color);
				font-size: 0.9rem;
			}

			.message.model .analysis-content .action-item .action-steps {
				color: var(--text-secondary);
				font-size: 0.95rem;
				line-height: 1.7;
				margin-top: 0.75rem;
			}

			/* Priority indicators */
			.message.model .analysis-content .priority-high {
				border-left-color: var(--error-color);
				background: linear-gradient(135deg, rgba(220, 38, 38, 0.08) 0%, rgba(220, 38, 38, 0.03) 100%);
			}

			.message.model .analysis-content .priority-medium {
				border-left-color: var(--warning-color);
				background: linear-gradient(135deg, rgba(217, 119, 6, 0.08) 0%, rgba(217, 119, 6, 0.03) 100%);
			}

			.message.model .analysis-content .priority-low {
				border-left-color: var(--primary-color);
				background: linear-gradient(135deg, rgba(30, 64, 175, 0.08) 0%, rgba(30, 64, 175, 0.03) 100%);
			}

			.message.model .analysis-content .summary-section {
				background: linear-gradient(135deg, var(--background-accent) 0%, rgba(124, 58, 237, 0.05) 100%);
				padding: 2rem;
				border-radius: var(--radius-xl);
				margin: 2rem 0;
				border: 2px solid var(--border-accent);
				box-shadow: var(--shadow-accent);
			}

			.message.model .analysis-content .summary-section h4 {
				color: var(--accent-color);
				margin: 0 0 1rem 0;
				font-size: 1.2rem;
				font-weight: 800;
				display: flex;
				align-items: center;
				gap: 0.75rem;
			}

			.message.model .analysis-content .summary-section h4::before {
				content: "\f0c5";
				font-family: "Font Awesome 6 Free";
				font-weight: 900;
				color: var(--accent-color);
				font-size: 1.1rem;
			}

			.analysis-type-badge {
				display: inline-flex;
				align-items: center;
				gap: 0.75rem;
				background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
				color: white;
				padding: 0.5rem 1.25rem;
				border-radius: 2rem;
				font-size: 0.95rem;
				font-weight: 600;
				margin-bottom: 1.5rem;
				box-shadow: var(--shadow-md);
			}

			.ocr-content {
				background: var(--background-tertiary);
				padding: 1.5rem;
				border-radius: var(--radius-lg);
				font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
				font-size: 0.95rem;
				line-height: 1.7;
				white-space: pre-wrap;
				border: 2px solid var(--border-color);
				max-height: 450px;
				overflow-y: auto;
			}

			.image-message {
				background: var(--background-primary);
				border: 2px solid var(--border-color);
				padding: 1rem;
				border-radius: var(--radius-xl);
				align-self: flex-end;
				max-width: 320px;
				box-shadow: var(--shadow-sm);
			}

			.chat-image {
				width: 100%;
				max-width: 280px;
				cursor: pointer;
				border-radius: var(--radius-lg);
				transition: transform 0.3s ease;
			}

			.chat-image:hover {
				transform: scale(1.03);
			}

			.modal {
				position: fixed;
				inset: 0;
				background: rgba(0, 0, 0, 0.8);
				display: none;
				justify-content: center;
				align-items: center;
				z-index: 1000;
				backdrop-filter: blur(8px);
			}

			.modal.show {
				display: flex;
				animation: fadeIn 0.3s ease-out;
			}

			@keyframes fadeIn {
				from { opacity: 0; }
				to { opacity: 1; }
			}

			.modal-content {
				background: var(--background-primary);
				padding: 2.5rem;
				border-radius: var(--radius-xl);
				position: relative;
				max-width: 90vw;
				max-height: 90vh;
				overflow: auto;
				box-shadow: var(--shadow-lg);
			}

			.modal-content img {
				max-width: 100%;
				height: auto;
				border-radius: var(--radius-lg);
			}

			.close-btn {
				position: absolute;
				top: 1.5rem;
				right: 1.5rem;
				background: var(--error-color);
				color: white;
				border: none;
				width: 40px;
				height: 40px;
				border-radius: 50%;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1rem;
				transition: all 0.2s ease;
				box-shadow: var(--shadow-md);
			}

			.close-btn:hover {
				background: #b91c1c;
				transform: scale(1.1);
			}

			.progress-bar {
				width: 100%;
				height: 6px;
				background: var(--background-tertiary);
				border-radius: 3px;
				overflow: hidden;
				margin: 1.5rem 0;
				box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
			}

			.progress-fill {
				height: 100%;
				background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
				border-radius: 3px;
				transition: width 0.4s ease;
				box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			}

			.results-notice {
				background: linear-gradient(135deg, var(--accent-light) 0%, rgba(30, 64, 175, 0.05) 100%);
				border: 2px solid var(--accent-color);
				border-radius: var(--radius-lg);
				padding: 1.5rem;
				margin-bottom: 1.5rem;
				text-align: center;
			}

			.results-notice h4 {
				color: var(--accent-color);
				font-size: 1.1rem;
				font-weight: 700;
				margin: 0 0 0.5rem 0;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 0.5rem;
			}

			.results-notice p {
				color: var(--text-secondary);
				margin: 0;
				font-size: 0.95rem;
				line-height: 1.5;
			}

			.empty-state {
				text-align: center;
				padding: 4rem 2rem;
				color: var(--text-muted);
			}

			.empty-state i {
				font-size: 4rem;
				margin-bottom: 1.5rem;
				opacity: 0.4;
				color: var(--accent-color);
			}

			.enhanced-placeholder {
				background: var(--background-primary);
				border: 3px solid var(--accent-color);
				border-radius: var(--radius-xl);
				padding: 2.5rem 2rem;
				text-align: center;
				color: var(--text-secondary);
				box-shadow: var(--shadow-md);
			}

			.enhanced-placeholder h3 {
				color: var(--accent-color);
				font-size: 1.4rem;
				font-weight: 700;
				margin: 0 0 1rem 0;
			}

			.enhanced-placeholder p {
				font-size: 1.1rem;
				line-height: 1.6;
				margin-bottom: 1.5rem;
				color: var(--text-secondary);
			}

			.sample-results {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 1.5rem;
				margin-top: 1.5rem;
			}

			.sample-card {
				background: var(--background-tertiary);
				padding: 1.5rem;
				border-radius: var(--radius-lg);
				border: 1px solid var(--border-color);
			}

			.sample-card h4 {
				color: var(--primary-color);
				font-size: 1rem;
				font-weight: 700;
				margin: 0 0 0.75rem 0;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.sample-card ul {
				margin: 0;
				padding-left: 0;
				font-size: 0.95rem;
				line-height: 1.7;
				list-style: none;
			}

			.sample-card li {
				margin-bottom: 0.75rem;
				color: var(--text-secondary);
				font-weight: 500;
				position: relative;
				padding-left: 1.5rem;
			}

			.sample-card li::before {
				content: "✓";
				position: absolute;
				left: 0;
				color: var(--success-color);
				font-weight: 700;
				font-size: 1rem;
			}

			.getting-started {
				background: var(--accent-light);
				border: 2px solid var(--border-accent);
				border-radius: var(--radius-lg);
				padding: 1.5rem;
				margin-top: 1.5rem;
			}

			.getting-started h4 {
				color: var(--accent-color);
				font-size: 1.1rem;
				font-weight: 700;
				margin: 0 0 1rem 0;
				display: flex;
				align-items: center;
				gap: 0.5rem;
			}

			.getting-started ol {
				margin: 0;
				padding-left: 1.5rem;
				color: var(--text-secondary);
				line-height: 1.7;
				font-size: 0.95rem;
			}

			.getting-started li {
				margin-bottom: 0.75rem;
				font-weight: 500;
			}

			/* Responsive Design */
			@media (max-width: 1024px) {
				.app-container {
					grid-template-columns: 1fr;
					grid-template-areas: 
						"header"
						"sidebar"
						"main";
				}
				
				.sidebar {
					border-right: none;
					border-bottom: 1px solid var(--border-color);
				}

				.sample-results {
					grid-template-columns: 1fr;
				}

				.chat-messages {
					min-height: 400px;
				}
			}

			@media (max-width: 768px) {
				.app-header {
					padding: 1rem;
				}
				
				.app-title {
					font-size: 1.25rem;
				}
				
				.sidebar,
				.main-content {
					padding: 1.5rem;
				}
				
				.controls-grid {
					grid-template-columns: 1fr;
				}

				.section {
					padding: 1.5rem;
				}

				.sample-results {
					grid-template-columns: 1fr;
				}

				.enhanced-placeholder {
					padding: 2rem 1rem;
				}

				.chat-messages {
					min-height: 350px;
				}
			}

			/* Accessibility improvements - Enhanced contrast */
			.sr-only {
				position: absolute;
				width: 1px;
				height: 1px;
				padding: 0;
				margin: -1px;
				overflow: hidden;
				clip: rect(0, 0, 0, 0);
				white-space: nowrap;
				border: 0;
			}

			*:focus {
				outline: 3px solid var(--accent-color);
				outline-offset: 2px;
			}

			button:focus,
			select:focus,
			input:focus {
				outline: none;
				box-shadow: 0 0 0 3px var(--accent-light);
			}

			/* High contrast mode support */
			@media (prefers-contrast: high) {
				:root {
					--text-primary: #000000;
					--text-secondary: #1a1a1a;
					--background-primary: #ffffff;
					--border-color: #666666;
				}
			}

			/* Reduced motion support */
			@media (prefers-reduced-motion: reduce) {
				*,
				*::before,
				*::after {
					animation-duration: 0.01ms !important;
					animation-iteration-count: 1 !important;
					transition-duration: 0.01ms !important;
				}
			}

			/* Custom scrollbar styling for better visibility */
			::-webkit-scrollbar {
				width: 8px;
				height: 8px;
			}

			::-webkit-scrollbar-track {
				background: var(--background-tertiary);
				border-radius: 4px;
			}

			::-webkit-scrollbar-thumb {
				background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
				border-radius: 4px;
				border: 1px solid var(--background-tertiary);
			}

			::-webkit-scrollbar-thumb:hover {
				background: linear-gradient(135deg, var(--accent-hover) 0%, var(--primary-hover) 100%);
				box-shadow: 0 2px 4px rgba(124, 58, 237, 0.3);
			}

			::-webkit-scrollbar-corner {
				background: var(--background-tertiary);
			}

			/* Firefox scrollbar styling */
			* {
				scrollbar-width: thin;
				scrollbar-color: var(--accent-color) var(--background-tertiary);
			}

			.chat-container {
				flex: 1;
				display: flex;
				flex-direction: column;
				min-height: 0;
			}
		</style>
		<script src="./script.js"></script>
	</head>
	<body>
		<div class="app-container" role="application" aria-label="Gemini Image Analysis Application">
			<!-- Header -->
			<header class="app-header">
				<h1 class="app-title">
					<i class="fas fa-eye" aria-hidden="true"></i>
					Gemini Image Analysis
				</h1>
				<div class="status-indicator">
					<div class="status-dot" aria-hidden="true"></div>
					<span>System Ready</span>
				</div>
			</header>

			<!-- Sidebar with Upload Controls -->
			<aside class="sidebar" role="complementary" aria-label="Upload and Analysis Controls">
				<section class="section">
					<h2 class="section-title">
						<i class="fas fa-upload" aria-hidden="true"></i>
						Upload Image
					</h2>
					
					<div class="upload-zone" 
						 id="uploadZone" 
						 tabindex="0" 
						 role="button" 
						 aria-label="Click to upload image or drag and drop"
						 onkeydown="handleUploadKeydown(event)">
						<input type="file" 
							   id="imageInput" 
							   class="file-input" 
							   accept="image/*" 
							   aria-label="Select image file">
						<i class="fas fa-cloud-upload-alt upload-icon" aria-hidden="true"></i>
						<div class="upload-text">Drop image here or click to browse</div>
						<div class="upload-subtitle">Support for JPG, PNG, GIF, WebP files</div>
					</div>

					<div class="preview-container" id="previewContainer">
						<img id="previewImage" class="preview-image" alt="Image preview">
						<div class="image-info" id="imageInfo"></div>
					</div>
				</section>

				<section class="section">
					<h2 class="section-title">
						<i class="fas fa-cog" aria-hidden="true"></i>
						Analysis Settings
					</h2>
					
					<div class="controls-grid">
						<div class="control-group">
							<label for="modelSelect" class="control-label">AI Model</label>
							<select id="modelSelect" class="select-input" aria-describedby="model-help">
								<option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
								<option value="gemma-3-27b-it">Gemma 3 27B</option>
								<option value="gemini-2.5-pro-preview-03-25">Gemini 2.5 Pro</option>
							</select>
							<div class="control-help">Select your preferred AI model. Gemini 2.0 Flash provides optimal speed and accuracy for most analyses.</div>
						</div>
						
						<div class="control-group">
							<label for="analysisMode" class="control-label">Analysis Type</label>
							<select id="analysisMode" class="select-input" aria-describedby="mode-help">
								<option value="analysis">UI/UX Analysis</option>
								<option value="ocr">Text Extraction (OCR)</option>
							</select>
							<div class="control-help">Choose UI/UX Analysis for design insights and usability feedback, or OCR for extracting text content from images.</div>
						</div>
					</div>

					<button id="analyzeBtn" 
							class="analyze-btn" 
							disabled 
							aria-describedby="analyze-help">
						<i class="fas fa-search" aria-hidden="true"></i>
						<span id="btnText">Analyze Image</span>
					</button>

					<div id="uploadProgressContainer" class="upload-progress">
						<h4>
							<i class="fas fa-upload" aria-hidden="true"></i>
							Processing Upload
						</h4>
						<div class="upload-progress-bar">
							<div class="upload-progress-fill" id="uploadProgressFill"></div>
						</div>
						<div class="upload-progress-text" id="uploadProgressText">Preparing image...</div>
					</div>

					<div id="progressContainer" style="display: none;">
						<div class="progress-bar">
							<div class="progress-fill" id="progressFill"></div>
						</div>
						<div id="progressText" class="upload-subtitle"></div>
					</div>
				</section>
			</aside>

			<!-- Main Content Area -->
			<main class="main-content" role="main" aria-label="Analysis Results">
				<section class="section chat-container">
					<h2 id="dynamicTitle" class="section-title dynamic-title">
						<i class="fas fa-upload" aria-hidden="true"></i>
						Upload Image to See Results
					</h2>
					
					<div id="chatMessages" 
						 class="chat-messages" 
						 role="log" 
						 aria-live="polite" 
						 aria-label="Analysis conversation">
						
						<div class="results-notice">
							<h4>
								<i class="fas fa-upload" aria-hidden="true"></i>
								Upload an Image to Begin Analysis
							</h4>
							<p>Start by uploading an image using the drag & drop area or browse button in the sidebar. Once uploaded, click "Analyze Image" to receive detailed AI-powered insights including visual design feedback, usability recommendations, and actionable improvements.</p>
						</div>
						
						<div class="enhanced-placeholder">
							<i class="fas fa-robot" aria-hidden="true"></i>
							<h3>AI-Powered Image Analysis</h3>
							<p>Upload an image to get detailed insights about design, usability, and visual elements. Our advanced AI will analyze your image and provide actionable feedback.</p>
							
							<div class="sample-results">
								<div class="sample-card">
									<h4><i class="fas fa-search" aria-hidden="true"></i> UI/UX Analysis</h4>
									<ul>
										<li>Visual hierarchy assessment</li>
										<li>Typography and readability review</li>
										<li>Color usage and contrast analysis</li>
										<li>Spacing and alignment evaluation</li>
										<li>Usability recommendations</li>
									</ul>
								</div>
								<div class="sample-card">
									<h4><i class="fas fa-text-width" aria-hidden="true"></i> Text Extraction (OCR)</h4>
									<ul>
										<li>Accurate text extraction</li>
										<li>Preserves original formatting</li>
										<li>Supports multiple languages</li>
										<li>High-quality recognition</li>
										<li>Structured output format</li>
									</ul>
								</div>
							</div>
							
							<div class="getting-started">
								<h4><i class="fas fa-lightbulb" aria-hidden="true"></i> Quick Tip</h4>
								<p>For best results, upload clear, high-resolution images and choose the analysis type that matches your needs.</p>
							</div>
						</div>
					</div>
				</section>
			</main>
		</div>
		
		<!-- Modal Dialog for Image Preview -->
		<div id="previewModal" 
			 class="modal" 
			 role="dialog" 
			 aria-labelledby="modal-title" 
			 aria-hidden="true">
			<div class="modal-content">
				<button class="close-btn" 
						onclick="closePreviewModal()" 
						aria-label="Close image preview">
					<i class="fas fa-times" aria-hidden="true"></i>
				</button>
				<h3 id="modal-title" class="sr-only">Image Preview</h3>
				<img id="previewModalImage" src="" alt="Full size image preview" />
			</div>
		</div>
		
		<script>
			// Enhanced configuration for Gemini API
			const generationConfig = {
				temperature: 1,
				topP: 0.95,
				topK: 40,
				maxOutputTokens: 8192,
				responseMimeType: "text/plain"
			};

			let chatHistory = [];
			let currentImageFile = null;
			let isAnalyzing = false;
			let currentStep = 0;

			// Progress steps for analysis
			const analysisSteps = [
				{ id: 1, label: "Upload", description: "Preparing image" },
				{ id: 2, label: "Process", description: "AI analyzing" },
				{ id: 3, label: "Generate", description: "Creating results" },
				{ id: 4, label: "Complete", description: "Finished" }
			];

			// Dynamic title management
			function updateDynamicTitle(state, analysisType = null) {
				const titleElement = document.getElementById("dynamicTitle");
				const icon = titleElement.querySelector("i");
				
				switch(state) {
					case 'initial':
						icon.className = "fas fa-upload";
						titleElement.lastChild.textContent = " Upload Image to See Results";
						break;
					case 'uploaded':
						icon.className = "fas fa-image";
						titleElement.lastChild.textContent = " Image Ready for Analysis";
						break;
					case 'analyzing':
						icon.className = "fas fa-cog fa-spin";
						const type = analysisType === 'ocr' ? 'OCR' : 'UI/UX';
						titleElement.lastChild.textContent = ` Analyzing Image (${type})`;
						break;
					case 'results':
						icon.className = "fas fa-comments";
						titleElement.lastChild.textContent = " Analysis Results";
						break;
				}
			}

			// Enhanced message functions with timestamps and better UX
			function appendMessage(role, text, analysisType = null) {
				const chatMessages = document.getElementById("chatMessages");
				
				// Remove enhanced placeholder and results notice if they exist
				const placeholder = chatMessages.querySelector(".enhanced-placeholder");
				const notice = chatMessages.querySelector(".results-notice");
				if (placeholder) {
					placeholder.remove();
				}
				if (notice) {
					notice.remove();
				}
				
				const msgDiv = document.createElement("div");
				msgDiv.className = "message " + role;
				
				let formattedContent = text;
				
				// Enhanced formatting for model responses
				if (role === "model") {
					formattedContent = formatAnalysisResponse(text, analysisType);
				}
				
				msgDiv.innerHTML = `
					<div class="message-content">${formattedContent}</div>
				`;
				chatMessages.appendChild(msgDiv);
				chatMessages.scrollTop = chatMessages.scrollHeight;
				
				// Update title to show results
				if (role === "model") {
					updateDynamicTitle('results');
					announceToScreenReader("Analysis complete: " + text.substring(0, 100));
				}
			}

			function appendImageMessage(file) {
				const chatMessages = document.getElementById("chatMessages");
				
				// Remove enhanced placeholder and results notice if they exist
				const placeholder = chatMessages.querySelector(".enhanced-placeholder");
				const notice = chatMessages.querySelector(".results-notice");
				if (placeholder) {
					placeholder.remove();
				}
				if (notice) {
					notice.remove();
				}
				
				// Don't add redundant image thumbnail to chat area
				// Just update the title to show image is ready
				updateDynamicTitle('uploaded');
			}

			// Enhanced progress indication with prominent status messages
			function showAnalysisProgress() {
				const chatMessages = document.getElementById("chatMessages");
				
				// Remove placeholder if it exists
				const placeholder = chatMessages.querySelector(".enhanced-placeholder");
				if (placeholder) {
					placeholder.remove();
				}
				
				const progressDiv = document.createElement("div");
				progressDiv.className = "analysis-progress";
				progressDiv.id = "analysisProgress";
				
				progressDiv.innerHTML = `
					<h4>
						<i class="fas fa-brain" aria-hidden="true"></i>
						AI Analysis in Progress
					</h4>
					<div class="progress-steps">
						<div class="progress-line" id="progressLine"></div>
						${analysisSteps.map(step => `
							<div class="step" id="step${step.id}" data-step="${step.id}">
								${step.id}
							</div>
						`).join('')}
					</div>
					<div class="step-labels">
						${analysisSteps.map(step => `
							<div class="step-label" id="label${step.id}">
								${step.label}
							</div>
						`).join('')}
					</div>
					<div id="currentStepDescription" class="progress-status-text">
						${analysisSteps[0].description}
					</div>
				`;
				
				chatMessages.appendChild(progressDiv);
				chatMessages.scrollTop = chatMessages.scrollHeight;
			}

			function updateAnalysisProgress(stepNumber, description) {
				const progressLine = document.getElementById("progressLine");
				const currentStepDesc = document.getElementById("currentStepDescription");
				
				if (!progressLine) return;
				
				// Update progress line width
				const progressPercent = ((stepNumber - 1) / (analysisSteps.length - 1)) * 100;
				progressLine.style.width = progressPercent + "%";
				
				// Update step states
				analysisSteps.forEach(step => {
					const stepElement = document.getElementById(`step${step.id}`);
					const labelElement = document.getElementById(`label${step.id}`);
					
					if (step.id < stepNumber) {
						stepElement.classList.remove("active");
						stepElement.classList.add("completed");
						stepElement.innerHTML = '<i class="fas fa-check"></i>';
						labelElement.classList.remove("active");
					} else if (step.id === stepNumber) {
						stepElement.classList.add("active");
						stepElement.classList.remove("completed");
						stepElement.textContent = step.id;
						labelElement.classList.add("active");
					} else {
						stepElement.classList.remove("active", "completed");
						stepElement.textContent = step.id;
						labelElement.classList.remove("active");
					}
				});
				
				// Update description with enhanced prominence
				if (currentStepDesc) {
					currentStepDesc.textContent = description || analysisSteps[stepNumber - 1]?.description || "";
					// Add extra emphasis for key stages
					if (description && (description.includes("summary") || description.includes("analyzing") || description.includes("generating"))) {
						currentStepDesc.style.fontSize = "1.2rem";
						currentStepDesc.style.fontWeight = "800";
					}
				}
				
				currentStep = stepNumber;
			}

			function hideAnalysisProgress() {
				const progressDiv = document.getElementById("analysisProgress");
				if (progressDiv) {
					setTimeout(() => {
						progressDiv.style.opacity = "0";
						progressDiv.style.transform = "translateY(-10px)";
						setTimeout(() => progressDiv.remove(), 300);
					}, 1000);
				}
			}

			// Upload progress indication
			function showUploadProgress() {
				const container = document.getElementById("uploadProgressContainer");
				const fill = document.getElementById("uploadProgressFill");
				const text = document.getElementById("uploadProgressText");
				
				container.classList.add("show");
				fill.style.width = "0%";
				text.textContent = "Reading file...";
				
				// Simulate upload progress
				let progress = 0;
				const interval = setInterval(() => {
					progress += Math.random() * 15;
					if (progress > 90) progress = 90;
					
					fill.style.width = progress + "%";
					
					if (progress < 30) {
						text.textContent = "Reading file...";
					} else if (progress < 60) {
						text.textContent = "Processing image data...";
					} else if (progress < 90) {
						text.textContent = "Preparing for analysis...";
					}
				}, 200);
				
				return () => {
					clearInterval(interval);
					fill.style.width = "100%";
					text.textContent = "Upload complete!";
					setTimeout(() => {
						container.classList.remove("show");
					}, 1000);
				};
			}

			function updateDownloadStatus(status, message, detail = null) {
				// This function is kept for compatibility but does nothing
				// since we removed the Downloads section
			}

			function formatAnalysisResponse(text, analysisType) {
				if (analysisType === 'ocr') {
					return `
						<div class="analysis-type-badge">
							<i class="fas fa-text-width" aria-hidden="true"></i>
							Text Extraction (OCR)
						</div>
						<div class="ocr-content">${text}</div>
					`;
				}

				// Format UI/UX analysis with better structure
				let formattedText = text;
				
				// Add analysis type badge
				const badge = `
					<div class="analysis-type-badge">
						<i class="fas fa-search" aria-hidden="true"></i>
						UI/UX Analysis
					</div>
				`;

				// Structure the analysis content
				const analysisContent = `<div class="analysis-content">${formatAnalysisText(formattedText)}</div>`;
				
				return badge + analysisContent;
			}

			function formatAnalysisText(text) {
				// Remove ** emphasis markers for cleaner text
				text = text.replace(/\*\*(.*?)\*\*/g, '$1');
				
				// Split text into lines and process
				let lines = text.split('\n').filter(line => line.trim());
				let formatted = '';
				let currentSection = '';
				let inList = false;
				let sectionType = '';

				for (let line of lines) {
					line = line.trim();
					if (!line) continue;

					// Check for section headers (lines ending with colon or containing section keywords)
					if ((line.endsWith(':') && line.length < 80) || 
						line.match(/^(Visual Design Issues?|Usability Concerns?|Positive Aspects?|Priority Recommendations?)/i)) {
						
						if (inList) {
							formatted += '</ul>';
							inList = false;
						}
						
						let sectionTitle = line.replace(':', '').trim();
						
						// Determine section type for appropriate styling and icons
						if (sectionTitle.toLowerCase().includes('visual') || sectionTitle.toLowerCase().includes('design issues')) {
							sectionType = 'issues';
						} else if (sectionTitle.toLowerCase().includes('usability') || sectionTitle.toLowerCase().includes('concerns')) {
							sectionType = 'usability';
						} else if (sectionTitle.toLowerCase().includes('positive') || sectionTitle.toLowerCase().includes('aspects')) {
							sectionType = 'positive';
						} else if (sectionTitle.toLowerCase().includes('recommendation') || sectionTitle.toLowerCase().includes('priority')) {
							sectionType = 'recommendations';
						} else {
							sectionType = 'general';
						}
						
						formatted += `<h3 data-section="${sectionType}">${sectionTitle}</h3>`;
						continue;
					}

					// Check for list items (starting with -, •, or numbers)
					if (line.match(/^[-•*]\s/) || line.match(/^\d+\.\s/)) {
						if (!inList) {
							formatted += '<ul>';
							inList = true;
						}
						
						let cleanLine = line.replace(/^[-•*]\s/, '').replace(/^\d+\.\s/, '');
						
						// Determine item type based on content and current section
						let itemClass = 'analysis-item';
						
						if (sectionType === 'issues') {
							itemClass = 'issue-item';
						} else if (sectionType === 'usability') {
							itemClass = 'usability-item';
						} else if (sectionType === 'positive') {
							itemClass = 'positive-item';
						} else if (sectionType === 'recommendations') {
							// For recommendations, make them more actionable
							itemClass = 'recommendation-item';
							cleanLine = makeActionable(cleanLine);
						}
						
						formatted += `<li><div class="${itemClass}">${cleanLine}</div></li>`;
						continue;
					}

					// Regular paragraph
					if (inList) {
						formatted += '</ul>';
						inList = false;
					}

					// Check for summary or conclusion sections
					if (line.toLowerCase().includes('summary') || 
						line.toLowerCase().includes('conclusion') ||
						line.toLowerCase().includes('overall')) {
						formatted += `<div class="summary-section"><h4>Summary</h4><p>${line}</p></div>`;
					} else if (sectionType === 'recommendations' && line.length > 20) {
						// For recommendation sections, format paragraphs as actionable items
						formatted += `<div class="action-item">
							<div class="action-title">Action Required</div>
							<div class="action-steps">${makeActionable(line)}</div>
						</div>`;
					} else {
						formatted += `<p>${line}</p>`;
					}
				}

				if (inList) {
					formatted += '</ul>';
				}

				return formatted || text; // Fallback to original text if formatting fails
			}
			
			// Helper function to make recommendations more actionable
			function makeActionable(text) {
				// Add action-oriented language and clear next steps
				if (text.toLowerCase().includes('improve') || text.toLowerCase().includes('enhance')) {
					return `${text} <strong>Next steps:</strong> Review current implementation and create an improvement plan with specific deadlines.`;
				} else if (text.toLowerCase().includes('add') || text.toLowerCase().includes('include')) {
					return `${text} <strong>Action:</strong> Prioritize this addition in your next design iteration.`;
				} else if (text.toLowerCase().includes('remove') || text.toLowerCase().includes('eliminate')) {
					return `${text} <strong>Action:</strong> Schedule this for immediate removal or redesign.`;
				} else if (text.toLowerCase().includes('consider') || text.toLowerCase().includes('think about')) {
					return `${text} <strong>Action:</strong> Conduct user research or A/B testing to validate this approach.`;
				} else if (text.toLowerCase().includes('redesign') || text.toLowerCase().includes('restructure')) {
					return `${text} <strong>Action:</strong> Create wireframes and prototypes before implementation.`;
				}
				
				// For general recommendations, add actionable context
				return `${text} <strong>Action:</strong> Review and implement this recommendation based on your project priorities.`;
			}

			// Enhanced preview functions with keyboard support
			function showPreview(file) {
				const modal = document.getElementById("previewModal");
				const previewImage = document.getElementById("previewModalImage");
				previewImage.src = URL.createObjectURL(file);
				modal.classList.add("show");
				modal.setAttribute("aria-hidden", "false");
				document.querySelector(".close-btn").focus();
			}

			function closePreviewModal() {
				const modal = document.getElementById("previewModal");
				modal.classList.remove("show");
				modal.setAttribute("aria-hidden", "true");
				document.getElementById("previewModalImage").src = "";
			}

			// Enhanced file handling with better validation and upload progress
			function readFileAsBase64(file) {
				return new Promise((resolve, reject) => {
					if (!file.type.startsWith('image/')) {
						reject(new Error('Please select a valid image file.'));
						return;
					}
					
					if (file.size > 10 * 1024 * 1024) { // 10MB limit
						reject(new Error('Image file too large. Please select a file under 10MB.'));
						return;
					}
					
					const finishProgress = showUploadProgress();
					
					const reader = new FileReader();
					reader.onload = () => {
						finishProgress();
						resolve(reader.result.split(",")[1]);
					};
					reader.onerror = () => {
						finishProgress();
						reject(new Error('Failed to read the image file.'));
					};
					reader.readAsDataURL(file);
				});
			}

			// Remove all download-related functions
			function processInlineData(result) {
				// This function is now empty since we removed the Downloads section
				// The analysis results are displayed directly in the chat
			}

			// UI State Management Functions
			function setAnalyzingState(analyzing) {
				isAnalyzing = analyzing;
				const btn = document.getElementById("analyzeBtn");
				const btnText = document.getElementById("btnText");
				
				if (analyzing) {
					btn.disabled = true;
					btnText.innerHTML = '<div class="spinner"></div> Analyzing...';
				} else {
					btn.disabled = !currentImageFile;
					btnText.innerHTML = '<i class="fas fa-search" aria-hidden="true"></i> Analyze Image';
				}
			}

			function showAlert(message, type) {
				const chatMessages = document.getElementById("chatMessages");
				const alert = document.createElement("div");
				alert.className = `alert ${type}`;
				alert.style.cssText = `
					padding: 1rem 1.5rem;
					margin: 1rem 0;
					border-radius: var(--radius-lg);
					background: ${type === 'error' ? 'rgba(220, 38, 38, 0.1)' : 'rgba(5, 150, 105, 0.1)'};
					border: 2px solid ${type === 'error' ? 'var(--error-color)' : 'var(--success-color)'};
					color: ${type === 'error' ? 'var(--error-color)' : 'var(--success-color)'};
					font-weight: 600;
					display: flex;
					align-items: center;
					gap: 0.75rem;
				`;
				alert.innerHTML = `
					<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'}" aria-hidden="true"></i>
					${message}
				`;
				chatMessages.appendChild(alert);
				chatMessages.scrollTop = chatMessages.scrollHeight;
				
				// Auto-remove after 5 seconds
				setTimeout(() => {
					if (alert.parentNode) {
						alert.remove();
					}
				}, 5000);
			}

			function updateImagePreview(file) {
				const container = document.getElementById("previewContainer");
				const preview = document.getElementById("previewImage");
				const info = document.getElementById("imageInfo");
				
				preview.src = URL.createObjectURL(file);
				info.innerHTML = `
					<strong>${file.name}</strong><br>
					Size: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
					Type: ${file.type}
				`;
				container.classList.add("show");
			}

			function updateUploadZone(hasFile) {
				const zone = document.getElementById("uploadZone");
				const btn = document.getElementById("analyzeBtn");
				
				if (hasFile) {
					zone.classList.add("has-file");
					btn.disabled = false;
				} else {
					zone.classList.remove("has-file");
					btn.disabled = true;
				}
			}

			// Enhanced drag and drop functionality
			function setupDragAndDrop() {
				const uploadZone = document.getElementById("uploadZone");
				let dragCounter = 0;

				['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
					uploadZone.addEventListener(eventName, preventDefaults, false);
					document.body.addEventListener(eventName, preventDefaults, false);
				});

				function preventDefaults(e) {
					e.preventDefault();
					e.stopPropagation();
				}

				uploadZone.addEventListener('dragenter', function(e) {
					dragCounter++;
					uploadZone.classList.add('drag-over');
				});

				uploadZone.addEventListener('dragleave', function(e) {
					dragCounter--;
					if (dragCounter === 0) {
						uploadZone.classList.remove('drag-over');
					}
				});

				uploadZone.addEventListener('drop', function(e) {
					dragCounter = 0;
					uploadZone.classList.remove('drag-over');
					
					const files = e.dataTransfer.files;
					if (files.length > 0) {
						handleFileSelection(files[0]);
					}
				});
			}

			function handleFileSelection(file) {
				if (!file.type.startsWith('image/')) {
					showAlert("Please select a valid image file.", "error");
					return;
				}
				
				currentImageFile = file;
				updateImagePreview(file);
				updateUploadZone(true);
				appendImageMessage(file);
				
				// Update file input for consistency
				const dt = new DataTransfer();
				dt.items.add(file);
				document.getElementById("imageInput").files = dt.files;
			}

			function handleUploadKeydown(event) {
				if (event.key === 'Enter' || event.key === ' ') {
					event.preventDefault();
					document.getElementById('imageInput').click();
				}
			}

			// Accessibility helper
			function announceToScreenReader(message) {
				const announcement = document.createElement('div');
				announcement.setAttribute('aria-live', 'polite');
				announcement.setAttribute('aria-atomic', 'true');
				announcement.className = 'sr-only';
				announcement.textContent = message;
				document.body.appendChild(announcement);
				setTimeout(() => document.body.removeChild(announcement), 1000);
			}

			// Enhanced event listeners
			document.getElementById("imageInput").addEventListener("change", function(e) {
				const file = e.target.files[0];
				if (file) {
					handleFileSelection(file);
				}
			});

			// Enhanced paste handling
			document.addEventListener("paste", function(e) {
				let items = e.clipboardData && e.clipboardData.items;
				if (!items) return;
				
				for (let i = 0; i < items.length; i++) {
					const item = items[i];
					if (item.kind === "file" && item.type.indexOf("image") !== -1) {
						const blob = item.getAsFile();
						handleFileSelection(blob);
						showAlert("Image pasted successfully!", "success");
						break;
					}
				}
			});

			// Modal keyboard handling
			document.addEventListener('keydown', function(e) {
				const modal = document.getElementById('previewModal');
				if (modal.classList.contains('show') && e.key === 'Escape') {
					closePreviewModal();
				}
			});

			// Click outside modal to close
			document.getElementById('previewModal').addEventListener('click', function(e) {
				if (e.target === this) {
					closePreviewModal();
				}
			});

			// Upload zone click handler
			document.getElementById("uploadZone").addEventListener("click", function() {
				document.getElementById("imageInput").click();
			});

			// Analyze button event listener
			document.getElementById("analyzeBtn").addEventListener("click", runAnalysis);

			// Enhanced interactivity for Analysis Settings
			function addSelectionFeedback() {
				const modelSelect = document.getElementById("modelSelect");
				const analysisMode = document.getElementById("analysisMode");
				
				// Add change event listeners for visual feedback
				modelSelect.addEventListener('change', function(e) {
					// Add visual feedback class
					e.target.classList.add('changed');
					
					// Remove the class after animation
					setTimeout(() => {
						e.target.classList.remove('changed');
					}, 600);
					
					// Optional: Show which model was selected
					console.log('AI Model changed to:', e.target.value);
				});
				
				analysisMode.addEventListener('change', function(e) {
					// Add visual feedback class
					e.target.classList.add('changed');
					
					// Remove the class after animation
					setTimeout(() => {
						e.target.classList.remove('changed');
					}, 600);
					
					// Update help text dynamically based on selection
					const helpText = e.target.parentNode.querySelector('.control-help');
					if (e.target.value === 'analysis') {
						helpText.textContent = 'UI/UX Analysis will provide detailed design insights, usability feedback, and actionable recommendations for improving your interface.';
					} else {
						helpText.textContent = 'OCR will extract all readable text from your image while preserving formatting and structure for easy copying and editing.';
					}
					
					console.log('Analysis type changed to:', e.target.value);
				});
			}

			// Initialize drag and drop on page load
			document.addEventListener('DOMContentLoaded', function() {
				setupDragAndDrop();
				updateDynamicTitle('initial');
				addSelectionFeedback();
			});

			async function performAnalysis(session, base64Data, mimeType) {
				// Step 1: Chain-of-thought analysis
				updateAnalysisProgress(3, "Performing deep UI/UX analysis");
				
				const cotParts = [
					{
						text: "Analyze this image using chain-of-thought reasoning. Think step by step:\n\n1. First, describe what you see in the image (layout, elements, content, design)\n2. Then, systematically examine each aspect for potential issues:\n   - Visual hierarchy and layout\n   - Typography and readability\n   - Color usage and contrast\n   - Spacing and alignment\n   - Content organization\n   - Usability and user experience\n   - Technical quality\n3. For each area, think through what works well and what doesn't\n4. Consider the intended purpose/audience and how well the design serves that\n\nBe thorough in your thinking process. This analysis will be used to generate a final issue summary."
					},
					{
						inline_data: {
							data: base64Data,
							mime_type: mimeType
						}
					}
				];
				
				const cotMessage = { role: "user", parts: cotParts };
				const cotResult = await session.sendMessage(cotMessage);
				
				if (!cotResult.candidates || cotResult.candidates.length === 0) {
					throw new Error("No response from CoT analysis");
				}
				
				const cotAnalysis = cotResult.candidates[0].content.parts
					.filter(p => p.text)
					.map(p => p.text)
					.join("\n");
				
				// Step 2: Summarize the CoT analysis
				updateAnalysisProgress(3, "Generating structured summary");
				
				const summaryMessage = {
					role: "user",
					parts: [{
						text: `Based on this detailed analysis, create a structured summary of the findings. Format the response exactly as follows:

Visual Design Issues:
- List specific visual design problems found (typography, color, spacing, layout issues)
- Include specific technical issues or inconsistencies

Usability Concerns:
- List user experience and usability problems
- Include navigation, accessibility, and interaction issues

Positive Aspects:
- List what works well in the design
- Highlight effective design choices and strengths

Priority Recommendations:
- Provide specific, actionable improvements with clear next steps
- Focus on high-impact changes that will improve user experience
- Use action-oriented language (improve, add, remove, redesign, etc.)

Important formatting notes:
- Use simple list format with hyphens (-)
- Avoid using ** for emphasis - use clear, descriptive language instead
- Be specific and actionable in recommendations
- If no significant issues are found, clearly state "No significant issues identified" and focus on positive aspects

Analysis: ${cotAnalysis}`
					}]
				};
				
				const summaryResult = await session.sendMessage(summaryMessage);
				
				if (summaryResult.candidates && summaryResult.candidates.length > 0) {
					const finalSummary = summaryResult.candidates[0].content.parts
						.filter(p => p.text)
						.map(p => p.text)
						.join("\n");
					appendMessage("model", finalSummary || "No response received.", "analysis");
					processInlineData(summaryResult);
				}
			}

			// Enhanced chat session with better error handling
			async function startChatSession(selectedModel) {
				return {
					sendMessage: async function(messageData) {
						try {
							let userMessage = typeof messageData === "string"
								? { role: "user", parts: [{ text: messageData }] }
								: messageData;
							const requestBody = {
								contents: [...chatHistory, userMessage],
								generationConfig
							};
							const url = "https://generativelanguage.googleapis.com/v1beta/models/" + selectedModel +
								":generateContent?key=" + apiKey;
							const response = await fetch(url, {
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify(requestBody)
							});
							
							if (!response.ok) {
								const errorText = await response.text();
								throw new Error(`API error ${response.status}: ${errorText}`);
							}
							
							const result = await response.json();
							if (result.candidates && result.candidates.length > 0) {
								const modelResponse = {
									role: "model",
									parts: result.candidates[0].content.parts
								};
								chatHistory.push(userMessage, modelResponse);
							} else {
								throw new Error("No response from API");
							}
							return result;
						} catch (error) {
							console.error('Chat session error:', error);
							throw error;
						}
					}
				};
			}

			// Enhanced analysis function with progress tracking
			async function runAnalysis() {
				if (isAnalyzing) return;
				
				const imageFile = currentImageFile;
				if (!imageFile) {
					showAlert("Please upload an image first.", "error");
					return;
				}
				
				const analysisMode = document.getElementById("analysisMode").value;
				const actionText = analysisMode === "ocr" ? "OCR" : "analysis";
				
				setAnalyzingState(true);
				updateDynamicTitle('analyzing', analysisMode);
				
				// Show enhanced progress indication
				showAnalysisProgress();
				updateAnalysisProgress(1, "Preparing image for " + actionText);
				
				try {
					updateAnalysisProgress(2, "Reading and processing image data");
					const base64Data = await readFileAsBase64(imageFile);
					
					updateAnalysisProgress(2, "Connecting to AI model");
					const modelSelect = document.getElementById("modelSelect");
					const selectedModel = modelSelect.value;
					const session = await startChatSession(selectedModel);
					
					if (analysisMode === "ocr") {
						await performOCR(session, base64Data, imageFile.type);
					} else {
						await performAnalysis(session, base64Data, imageFile.type);
					}
					
					updateAnalysisProgress(4, "Analysis complete!");
					setTimeout(() => hideAnalysisProgress(), 2000);
					
				} catch (err) {
					console.error('Analysis error:', err);
					showAlert("Error: " + err.message, "error");
					hideAnalysisProgress();
					updateDynamicTitle('uploaded');
				} finally {
					setAnalyzingState(false);
				}
			}
		</script>
	</body>
</html>